<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help & Support - StockMaster</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary:#2c3e50; --secondary:#3498db; --accent:#e74c3c; --light:#ecf0f1; --dark:#2c3e50; --success:#2ecc71; --warning:#f39c12; --danger:#e74c3c; --gray:#95a5a6; }
        *{ margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body{ background:#f5f7fa; color:#333; line-height:1.6; }
        .container{ display:grid; grid-template-columns:250px 1fr; min-height:100vh; }
        .sidebar{ background:var(--primary); color:#fff; padding:20px 0; position:fixed; width:250px; height:100vh; overflow-y:auto; }
        .logo{ text-align:center; padding:20px 0; border-bottom:1px solid rgba(255,255,255,.1); margin-bottom:20px; }
        .logo h1{ font-size:24px; font-weight:600; }
        .logo span{ color:var(--secondary); }
        .menu-item{ padding:15px 25px; display:flex; align-items:center; cursor:pointer; transition:all .3s; }
        .menu-item:hover, .menu-item.active{ background:rgba(255,255,255,.1); border-left:4px solid var(--secondary); }
        .menu-item i{ margin-right:15px; font-size:18px; }
        .main-content{ grid-column:2; padding:20px; }
        .header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; background:#fff; padding:15px 20px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.05); }
        .search-bar{ display:flex; align-items:center; background:#f5f7fa; border-radius:4px; padding:8px 15px; width:300px; }
        .search-bar input{ border:none; background:transparent; width:100%; padding:5px; outline:none; }
        .user-profile{ display:flex; align-items:center; }
        .user-profile img{ width:40px; height:40px; border-radius:50%; margin-right:10px; object-fit:cover; }
        .page-title{ font-size:24px; font-weight:600; color:var(--dark); margin-bottom:15px; }
        .cards{ display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px; margin-bottom:20px; }
        .card{ background:#fff; border-radius:8px; padding:20px; box-shadow:0 2px 10px rgba(0,0,0,.05); }
        .card h3{ font-size:18px; margin-bottom:10px; }
        .quick-links a{ display:flex; align-items:center; gap:10px; padding:10px; border:1px solid #eee; border-radius:6px; color:inherit; text-decoration:none; margin-bottom:10px; }
        .faq-item{ border-bottom:1px solid #eee; padding:12px 0; }
        .faq-q{ display:flex; justify-content:space-between; cursor:pointer; font-weight:600; }
        .faq-a{ display:none; color:#555; margin-top:8px; }
        form .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
        label{ font-size:12px; color:var(--gray); }
        input[type="text"], input[type="email"], textarea, select{ width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; }
        textarea{ min-height:100px; resize:vertical; }
        .btn{ padding:10px 14px; border:none; border-radius:4px; cursor:pointer; font-weight:500; }
        .btn-primary{ background:var(--secondary); color:#fff; }
        @media (max-width: 992px){ .container{ grid-template-columns:1fr; } .sidebar{ display:none; } .main-content{ grid-column:1; } }
        @media (max-width: 768px){ form .row{ grid-template-columns:1fr; } .header{ flex-direction:column; align-items:flex-start; } .search-bar{ width:100%; margin-bottom:15px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo"><h1>Stock<span>Master</span></h1></div>
            <div class="menu-item" data-href="index.html"><i class="fas fa-home"></i><span>Dashboard</span></div>
            <div class="menu-item" data-href="products.html"><i class="fas fa-boxes"></i><span>Products</span></div>
            <div class="menu-item" data-href="inventory.html"><i class="fas fa-warehouse"></i><span>Inventory</span></div>
            <div class="menu-item" data-href="orders.html"><i class="fas fa-file-invoice-dollar"></i><span>Orders</span></div>
            <div class="menu-item" data-href="transfers.html"><i class="fas fa-exchange-alt"></i><span>Transfers</span></div>
            <div class="menu-item" data-href="reports.html"><i class="fas fa-chart-bar"></i><span>Reports</span></div>
            <div class="menu-item" data-href="suppliers.html"><i class="fas fa-users"></i><span>Suppliers</span></div>
            <div class="menu-item" data-href="settings.html"><i class="fas fa-cog"></i><span>Settings</span></div>
            <div class="menu-item active" data-href="help.html"><i class="fas fa-question-circle"></i><span>Help & Support</span></div>
        </div>
        <div class="main-content">
            <div class="header">
                <div class="search-bar"><i class="fas fa-search"></i><input type="text" placeholder="Search help..."></div>
                <div class="user-profile" id="user-profile">
                    <div style="margin-right:10px;">
                        <div id="user-name">User</div>
                        <small id="user-role">Authenticated</small>
                    </div>
                    <button id="btn-logout" class="btn" style="background:#fff; color:#e74c3c; border:1px solid #e74c3c; padding:8px 10px;">
                        <i class="fas fa-right-from-bracket"></i> Logout
                    </button>
                </div>
            </div>

            <div class="page-title">Help & Support</div>

            <div class="cards">
                <div class="card">
                    <h3>Quick Links</h3>
                    <div class="quick-links">
                        <a href="products.html"><i class="fas fa-box"></i> Managing Products</a>
                        <a href="inventory.html"><i class="fas fa-warehouse"></i> Inventory Tracking</a>
                        <a href="orders.html"><i class="fas fa-file-invoice"></i> Order Processing</a>
                        <a href="reports.html"><i class="fas fa-chart-line"></i> Generating Reports</a>
                        <a href="settings.html"><i class="fas fa-cog"></i> Account & Company Settings</a>
                    </div>
                </div>
                <div class="card">
                    <h3>FAQs</h3>
                    <div class="faq-item">
                        <div class="faq-q">How do I add a new product? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-a">Go to Products → Add Product and fill in the required fields.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">Can I export my inventory? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-a">Yes, visit Inventory and click Export to download a CSV.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">How to set low stock alerts? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-a">Open Settings → Notifications and enable Low Stock Alerts.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-q">How can I reset my password? <i class="fas fa-chevron-down"></i></div>
                        <div class="faq-a">Go to Settings → Security to change your password.</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Contact Support</h3>
                <form id="support-form">
                    <div class="row">
                        <div>
                            <label for="topic">Topic</label>
                            <select id="topic">
                                <option>General Question</option>
                                <option>Billing</option>
                                <option>Technical Issue</option>
                                <option>Feature Request</option>
                            </select>
                        </div>
                        <div>
                            <label for="email">Email</label>
                            <input type="email" id="email" placeholder="you@company.com" value="admin@stockmaster.app">
                        </div>
                    </div>
                    <div class="row" style="margin-top:12px;">
                        <div style="grid-column:1 / -1;">
                            <label for="message">Message</label>
                            <textarea id="message" placeholder="Describe your question or issue..."></textarea>
                        </div>
                    </div>
                    <div style="margin-top:12px;">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        (function(){
            const setHeader = (displayName, email) => {
                const name = displayName || email || 'User';
                const avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=3498db&color=fff`;
                const nameEl = document.getElementById('user-name');
                const avatarEl = document.getElementById('user-avatar');
                if (nameEl) nameEl.textContent = name;
                if (avatarEl) avatarEl.src = avatar;
            };
            const init = async () => {
                try {
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js');
                    const { getAuth, onAuthStateChanged, signOut } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js');
                    const app = initializeApp({ apiKey: "AIzaSyAqBR_6p-5752sVeu_aMT2sNU2I_nUmaOQ", authDomain: "inventory-3b638.firebaseapp.com", projectId: "inventory-3b638", storageBucket: "inventory-3b638.firebasestorage.app", messagingSenderId: "65748912542", appId: "1:65748912542:web:8d40510d194bb3e1d6ae8f", measurementId: "G-6ECQLDLS71" });
                    const auth = getAuth(app);
                    onAuthStateChanged(auth, async (user) => {
                        if (!user) { window.location.href = 'login.html'; return; }
                        setHeader(user.displayName, user.email);
                        const btn = document.getElementById('btn-logout');
                        if (btn) btn.onclick = () => signOut(auth).then(() => window.location.href = 'login.html');
                        await syncUserAccess(user);
                    });
                } catch (e) { window.location.href = 'login.html'; }
            };

            async function syncUserAccess(user) {
                try {
                    const { getFirestore, doc, getDoc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js');
                    const db = getFirestore();
                    const meRef = doc(db, 'users', user.uid);
                    const meSnap = await getDoc(meRef);
                    if (!meSnap.exists()) {
                        await setDoc(meRef, { 
                            role: 'staff', 
                            warehouses: [],
                            name: user.displayName || user.email || 'User',
                            email: user.email,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }, { merge: true });
                    }
                } catch (e) {
                    console.error('syncUserAccess error:', e);
                    // If user creation fails, still allow access with limited permissions
                }
            }

            init();
        })();

        document.addEventListener('DOMContentLoaded', function(){
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.addEventListener('click', function(){
                const href = this.dataset.href; if (href){ window.location.href = href; return; }
                menuItems.forEach(i => i.classList.remove('active')); this.classList.add('active');
            }));

            document.querySelectorAll('.faq-q').forEach(q => q.addEventListener('click', function(){
                const ans = this.nextElementSibling; const open = ans.style.display === 'block';
                document.querySelectorAll('.faq-a').forEach(a => a.style.display = 'none');
                ans.style.display = open ? 'none' : 'block';
            }));

            document.getElementById('support-form').addEventListener('submit', function(e){
                e.preventDefault();
                const topic = document.getElementById('topic').value;
                const email = document.getElementById('email').value;
                const message = document.getElementById('message').value.trim();
                if (!message){ alert('Please enter a message.'); return; }
                alert(`Support request sent!\nTopic: ${topic}\nEmail: ${email}`);
                this.reset();
            });
        });
    </script>
</body>
</html>
